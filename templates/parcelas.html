{% extends "base.html" %}
{% block content %}
<h1 class="h5 mb-3">Parcelas - Contrato {{ contrato.contrato or contrato.id }}</h1>

<div class="row g-3 mb-3">
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Valor</div>
      <div class="h6 mb-0">R$ {{ resumo.valor|brl }}</div>
    </div></div>
  </div>
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Valor pago</div>
      <div class="h6 mb-0">R$ {{ resumo.valor_pago|brl }}</div>
    </div></div>
  </div>
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Valor abatido</div>
      <div class="h6 mb-0">R$ {{ resumo.valor_abatido|brl }}</div>
    </div></div>
  </div>
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Custas</div>
      <div class="h6 mb-0">R$ {{ resumo.custas|brl }}</div>
    </div></div>
  </div>
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Custas deduzidas</div>
      <div class="h6 mb-0">R$ {{ resumo.custas_deduzidas|brl }}</div>
    </div></div>
  </div>
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Protesto</div>
      <div class="h6 mb-0">R$ {{ resumo.protesto|brl }}</div>
    </div></div>
  </div>
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Protesto deduzido</div>
      <div class="h6 mb-0">R$ {{ resumo.protesto_deduzido|brl }}</div>
    </div></div>
  </div>
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Honor치rio</div>
      <div class="h6 mb-0">R$ {{ resumo.honorario|brl }}</div>
    </div></div>
  </div>
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Honor치rio repassado</div>
      <div class="h6 mb-0">R$ {{ resumo.honorario_repassado|brl }}</div>
    </div></div>
  </div>
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Alvar치</div>
      <div class="h6 mb-0">R$ {{ resumo.alvara|brl }}</div>
    </div></div>
  </div>
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Alvar치 recebido</div>
      <div class="h6 mb-0">R$ {{ resumo.alvara_recebido|brl }}</div>
    </div></div>
  </div>
  <div class="col-md-2">
    <div class="card card-metric"><div class="card-body">
      <div class="small text-muted">Ganho</div>
      <div class="h6 mb-0">R$ {{ resumo.ganho|brl }}</div>
    </div></div>
  </div>
</div>

<table class="table table-sm align-middle">
  <thead class="table-light">
    <tr>
      <th>#</th>
      <th>Vencimento</th>
      <th>Valor</th>
      <th>Baixa</th>
    </tr>
  </thead>
  <tbody>
    {% for p in parcels %}
    <tr>
      <td>{{ p.numero }}</td>
      <td>{{ p.vencimento|datefmt }}</td>
      <td>R$ {{ p.valor|brl }}</td>
      <td>
        {% if p.baixado_em %}
          <span class="text-success">Baixada em {{ p.baixado_em|datefmt }}</span>
          <form method="post" action="{{ url_for('baixar_parcela', id=contrato.id, pid=p.id) }}" style="display:inline">
            <button class="btn btn-outline-secondary btn-sm">Desfazer</button>
          </form>
        {% else %}
          <form method="post" action="{{ url_for('baixar_parcela', id=contrato.id, pid=p.id) }}">
            <button class="btn btn-primary btn-sm">Dar Baixa</button>
          </form>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<a class="btn btn-outline-secondary" href="{{ url_for('index') }}">Voltar</a>
{% endblock %}
