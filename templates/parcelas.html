{% extends "base.html" %}
{% block content %}
<h4>Parcelas - Contrato {{ contrato.contrato or contrato.id }}</h4>

<div class="row g-2 mb-2">
  {% macro card(title, value) -%}
  <div class="col-md-3">
    <div class="card card-small">
      <div class="card-body">
        <div class="small text-muted">{{ title }}</div>
        <div class="fw-bold">{{ value }}</div>
      </div>
    </div>
  </div>
  {%- endmacro %}

  {{ card('Valor', 'R$ ' ~ (resumo.valor or 0)|brl) }}
  {{ card('Valor pago (boleto)', 'R$ ' ~ (resumo.pago or 0)|brl) }}
  {{ card('Valor abatido', 'R$ ' ~ (resumo.abatido or 0)|brl) }}
  {{ card('Custas', 'R$ ' ~ (resumo.custas or 0)|brl) }}
  {{ card('Honorário', 'R$ ' ~ (resumo.honorario or 0)|brl) }}
  {{ card('Alvará', 'R$ ' ~ (resumo.alvara or 0)|brl) }}
  {{ card('Ganho', 'R$ ' ~ (resumo.ganho or 0)|brl) }}
</div>

<table class="table table-sm table-striped align-middle">
  <thead>
    <tr>
      <th>#</th>
      <th>Vencimento</th>
      <th>Valor</th>
      <th>Baixa</th>
    </tr>
  </thead>
  <tbody>
  {% for p in parcels %}
    <tr>
      <td>{{ p.numero }}</td>
      <td>{{ p.vencimento }}</td>
      <td>R$ {{ (p.valor or 0)|brl }}</td>
      <td>
        {% if p.baixado_em %}
          <span class="text-success">Baixada em {{ p.baixado_em }}</span>
        {% else %}
          <form method="post" action="{{ url_for('baixar_parcela', parcela_id=p.id) }}">
            <button class="btn btn-primary btn-sm">Dar Baixa</button>
          </form>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<a class="btn btn-secondary" href="{{ url_for('index') }}">Voltar</a>
{% endblock %}
