
{% extends "base.html" %}
{% block content %}
<h3>Parcelas - Contrato {{ contrato.contrato or contrato.id }}</h3>

<div class="row g-2 mb-3">
  {% set cards = [
    ('Valor', resumo.valor),
    ('Valor pago', resumo.pago),
    ('Valor abatido', resumo.abatido),
    ('Custas', resumo.custas),
    ('Custas deduzida', resumo.custas_deduzida),
    ('Protesto', resumo.protesto),
    ('Protesto deduzido', resumo.protesto_deduzido),
    ('Honor치rio', resumo.honorario),
    ('Honor치rio repassado', resumo.honorario_repassado),
    ('Alvar치', resumo.alvara),
    ('Alvar치 recebido', resumo.alvara_recebido),
    ('Ganho', resumo.ganho)
  ] %}
  {% for label, val in cards %}
  <div class="col-md-3">
    <div class="border rounded p-2">
      <small class="text-muted">{{ label }}</small>
      <div><strong>R$ {{ (val or 0)|brl }}</strong></div>
    </div>
  </div>
  {% endfor %}
</div>

<table class="table table-sm table-striped">
  <thead>
    <tr>
      <th>#</th>
      <th>Vencimento</th>
      <th>Valor</th>
      <th>Baixa</th>
    </tr>
  </thead>
  <tbody>
  {% for p in parcels %}
    <tr>
      <td>{{ p.numero }}</td>
      <td>{{ p.vencimento.strftime('%d/%m/%Y') }}</td>
      <td>R$ {{ (p.valor or 0)|brl }}</td>
      <td>
        {% if p.baixado_em %}
          <span class="text-success">Baixada em {{ p.baixado_em.strftime('%d/%m/%Y') }}</span>
        {% else %}
        <form method="post" action="{{ url_for('baixar_parcela', contrato_id=contrato.id, parcela_id=p.id) }}">
          <button class="btn btn-primary btn-sm">Dar Baixa</button>
        </form>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<a href="{{ url_for('index') }}" class="btn btn-secondary btn-sm">Voltar</a>
{% endblock %}
